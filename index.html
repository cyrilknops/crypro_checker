<!doctype html>
<html lang="nl">
<head>
	<meta charset="UTF-8">
	<title>Coins</title>
	<link rel="stylesheet" href="js/lib/bootstrap/dist/css/bootstrap.min.css"/>
	<style type="text/css">
		.red {
			color: red;
		}
		.green {
			color: green;
		}
	</style>
</head>
<body ng-app="myApp">
	<div class="container" ng-controller="bikeController as vm">
		<h1>Coins</h1>
		<div class="row">
			<div class="col-md-12">
				<table class="table table-striped">
					<tr>
						<th>Name</th>
						<th>Value {{vm.currency}}</th>
						<th>Amount</th>
						<th>Price {{vm.currency}}</th>
						<th>Purchase price {{vm.currency}}</th>
						<th>Profit {{vm.currency}}</th>
						<th>% (1h)</th>
						<th>% (24h)</th>
						<th>Purchase date</th>
					</tr>
					<tr ng-repeat="coin in vm.coins">
						<td>{{coin.name}}</td>
						<td>{{coin.price | number:5}}</td>
						<td>{{coin.amount}}</td>
						<td>{{coin.price*coin.amount | number:2}}</td>
						<td>{{coin.purchase}}</td>
						<td ng-class='{red : !coin.succes, green: coin.succes}' >{{coin.price*coin.amount-coin.purchase | number:2}}</td>
						<td ng-class='{red : !coin.succes3, green: coin.succes3}' >{{coin.percent_change_1h | number:2}}</td>
						<td ng-class='{red : !coin.succes2, green: coin.succes2}' >{{coin.percent_change_24h | number:2}}</td>
						<td>{{coin.date}}</td>
					</tr>
				</table>
				<h3>Total Profit: <span ng-class='{red : !vm.succes, green: vm.succes}'>{{vm.totaal | number: 2}}</span> {{vm.currency}}</h3>
			</div>
		</div>
	</div>
<script src="js/lib/angular/angular.min.js"></script>
<script>
	angular.module('myApp', [])
			.controller('bikeController', filmController);
	function filmController($http) {
        // 0. initialisaties, variabelen
        var vm = this;
        var baseUrl = 'https://api.coinmarketcap.com/v1/';
        vm.total = 0;
        vm.currency = "EUR"; //Can be EUR or USD
        var coint = [
            {
            	name:'ethereum',
                amount: 1,
                purchase: 275.47,
                date: "10/10/2017"
            },
			{
                name:'bitcoin',
                amount: 0.01109924,
                purchase: 50.34,
				date: "29/8/2017"
        	}
		];
        vm.coins = [];
        vm.totaal = 0;
        vm.succes = false;
        coint.forEach(function (item, index) {
            $http({
                method: 'get',
                url   : baseUrl+ '/ticker/'+item.name+'/?convert=EUR'
            }).then(function (coins) {
                if(vm.currency == "EUR") {
                    vm.totaal = vm.totaal + coins.data[0].price_eur * item.amount - item.purchase;
                    coins.data[0].succes = coins.data[0].price_eur*item.amount-item.purchase > 0;
                    coins.data[0].price = coins.data[0].price_eur;
                }else if(vm.currency == "USD"){
                    vm.totaal = vm.totaal + coins.data[0].price_usd * item.amount - item.purchase;
                    coins.data[0].succes = coins.data[0].price_usd * item.amount-item.purchase > 0;
                    coins.data[0].price = coins.data[0].price_usd;
                }
                vm.succes = vm.totaal > 0;
                coins.data[0].succes2 = coins.data[0].percent_change_24h > 0;
                coins.data[0].succes3 = coins.data[0].percent_change_1h > 0;
                coins.data[0].amount = item.amount;
                coins.data[0].purchase = item.purchase;
                coins.data[0].date = item.date;
                vm.coins.push(coins.data[0]);
            }).catch(function (err) {
                alert('Error: er is een fout opgetreden ' + err);
            });
        });
    }
</script>
</body>
</html>